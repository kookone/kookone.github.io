---
layout: post
title: Spring Security与OAuth2介绍
category: Blog
tags: [Spring Security,OAuth2]
---

# OAuth2 初识

OAuth2.0是[OAuth](http://en.wikipedia.org/wiki/OAuth)协议的延续版本，OAuth是一个关于授权（authorization）的开放网络标准，但不[向后兼容](https://baike.baidu.com/item/%E5%90%91%E5%90%8E%E5%85%BC%E5%AE%B9/94553)OAuth 1.0即完全废止了OAuth1.0，OAuth 2.0关注客户端开发者的简易性。要么通过组织在资源拥有者和HTTP服务商之间的被批准的交互动作代表用户，要么允许第三方应用代表用户获得访问的权限。同时为Web应用，桌面应用和手机，和起居室设备提供专门的认证流程，在全世界得到广泛应用。

OAuth2 可以方便第三方应用(如豆瓣)获取用户在其他应用(如QQ)的信息。

比如用 QQ 账户登录优酷，优酷就会先让用户登录 QQ，然后让用户确认授权优酷访问 QQ 上的信息，确认后优酷就获得了 QQ 的 OAuth 服务器返回的 token，之后就可以通过 token 访问到 QQ 允许第三方应用访问的资源路径范围内的用户相关信息。

OAuth 2协议以及详细说明可以参考以下是相关的文章： 

- [RFC 6749 ](https://tools.ietf.org/html/rfc6749)
- [阮一峰 – 理解 OAuth 2.0](http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html) 
- [OAuth2 CSRF攻击](https://www.jianshu.com/p/c7c8f51713b6)
- [一张图搞定OAuth2.0](https://www.cnblogs.com/flashsun/p/7424071.html)

下面列举一些在理解上可能存在的疑问

> 第一个疑问： CAS的单点登录和oauth2的最大区别

CAS的单点登录时保障客户端的用户资源的安全

oauth2则是保障服务端的用户资源的安全

CAS客户端要获取的最终信息是，这个用户到底有没有权限访问我（CAS客户端）的资源。

oauth2获取的最终信息是，我（oauth2服务提供方）的用户的资源到底能不能让你（oauth2的客户端）访问

CAS的单点登录，资源都在客户端这边，不在CAS的服务器那一方。

用户在给CAS服务端提供了用户名密码后，作为CAS客户端并不知道这件事。

随便给客户端个ST，那么客户端是不能确定这个ST是用户伪造还是真的有效，所以要拿着这个ST去服务端再问一下，这个用户给我的是有效的ST还是无效的ST，是有效的我才能让这个用户访问。

oauth2认证，资源都在oauth2服务提供者那一方，客户端是想索取用户的资源。

所以在最安全的模式下，用户授权之后，服务端并不能直接返回token，通过重定向送给客户端，因为这个token有可能被黑客截获，如果黑客截获了这个token，那用户的资源也就暴露在这个黑客之下了。

于是聪明的服务端发送了一个认证code给客户端（通过重定向），客户端在后台，通过https的方式，用这个code，以及另一串客户端和服务端预先商量好的密码，才能获取到token和刷新token，这个过程是非常安全的。

如果黑客截获了code，他没有那串预先商量好的密码，他也是无法获取token的。这样oauth2就能保证请求资源这件事，是用户同意的，客户端也是被认可的，可以放心的把资源发给这个客户端了。

所以cas登录和oauth2在流程上的最大区别就是，通过ST或者code去认证的时候，需不需要预先商量好的密码。

以上转载：https://www.cnblogs.com/flying607/p/7652537.html
